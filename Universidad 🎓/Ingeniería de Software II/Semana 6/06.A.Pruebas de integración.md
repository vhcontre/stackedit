## 📅 Pruebas de integración

| Semana | Objetivos principales                                             |
| ------ | ----------------------------------------------------------------- |
| 6      | 🧪 Pruebas de integración                                         |
|        | 📘 Documentación con Swagger                                      |
|        | 🔄 Uso de GitHub Actions para lint + tests                        |

Asunto: Acceso al portal de alquiler
¡Excelente! Comencemos entonces con la **Semana 6**. Aquí te propongo una **planificación clara y paso a paso**, con foco en trazabilidad y enseñanza para tus estudiantes:

---

## ✅ Semana 6: Planificación

| Objetivo                         | Detalle técnico                                                             | ¿Qué vamos a hacer?                                                                           |
| -------------------------------- | --------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| 🧪 **Pruebas de integración**    | Validar la interacción real entre múltiples capas (API + DB real o de test) | Crear tests que simulen flujos completos (ej: login → crear producto → movimiento de entrada) |
| 📘 **Documentación con Swagger** | Asegurar que los endpoints estén correctamente documentados usando FastAPI  | Verificar que todos los `@router` tengan `summary`, `description` y ejemplos                  |
| 🔄 **GitHub Actions**            | Automatizar chequeo de calidad en cada `push`                               | Configurar workflow para: ejecutar `pytest` + correr `ruff` o `flake8` (lint)                 |

---

### 📍 Paso 1: Pruebas de integración

**Objetivo:** Validar flujos reales del sistema (como lo usaría un cliente).

#### ✅ Ejemplo inicial que vamos a crear

```python
# tests/integration/test_flujo_completo.py

def test_flujo_creacion_y_movimiento(client, db_session):
    # Crear usuario admin
    crear_usuario_con_rol(db_session, "admin", "admin123", "admin")

    # Login y obtención de token
    login_response = client.post("/auth/login", data={"username": "admin", "password": "admin123"})
    token = login_response.json()["access_token"]
    headers = {"Authorization": f"Bearer {token}"}

    # Crear producto
    producto_data = {"nombre": "Laptop", "sku": "LT123", "stock_minimo": 2}
    r_prod = client.post("/productos/", json=producto_data, headers=headers)
    assert r_prod.status_code == 201

    # Hacer un movimiento de entrada
    movimiento_data = {"sku_producto": "LT123", "tipo": "entrada", "cantidad": 5}
    r_mov = client.post("/movimientos/", json=movimiento_data, headers=headers)
    assert r_mov.status_code == 201
```

🔧 Esto permite verificar que:

* El login funcione
* Se puedan usar credenciales para acceder a endpoints protegidos
* La creación de producto y su movimiento esté enlazada correctamente

¿Te gustaría que avancemos creando este archivo juntos o querés que preparemos primero la parte de documentación con Swagger?

---

📌 *Sugerencia para trazar el avance en GitHub Project (Semana 6):*

* Tarea 1: Crear test de flujo completo de integración
* Tarea 2: Asegurar que todos los routers tengan summary + description
* Tarea 3: Crear archivo `.github/workflows/main.yml` para GitHub Actions

Avísame cómo querés avanzar: ¿empezamos con el test de integración? ¿o preferís ir primero con Swagger o GitHub Actions?



<!--stackedit_data:
eyJoaXN0b3J5IjpbMTYzNjY1MzY5NiwtODg0NDI1MzE5XX0=
-->