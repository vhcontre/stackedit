## ğŸ“… Pruebas de integraciÃ³n

| Semana | Objetivos principales                                             |
| ------ | ----------------------------------------------------------------- |
| 6      | ğŸ§ª Pruebas de integraciÃ³n                                         |
|        | ğŸ“˜ DocumentaciÃ³n con Swagger                                      |
|        | ğŸ”„ Uso de GitHub Actions para lint + tests                        |

Asunto: Acceso al portal de alquiler
Â¡Excelente! Comencemos entonces con la **Semana 6**. AquÃ­ te propongo una **planificaciÃ³n clara y paso a paso**, con foco en trazabilidad y enseÃ±anza para tus estudiantes:

---

## âœ… Semana 6: PlanificaciÃ³n

| Objetivo                         | Detalle tÃ©cnico                                                             | Â¿QuÃ© vamos a hacer?                                                                           |
| -------------------------------- | --------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| ğŸ§ª **Pruebas de integraciÃ³n**    | Validar la interacciÃ³n real entre mÃºltiples capas (API + DB real o de test) | Crear tests que simulen flujos completos (ej: login â†’ crear producto â†’ movimiento de entrada) |
| ğŸ“˜ **DocumentaciÃ³n con Swagger** | Asegurar que los endpoints estÃ©n correctamente documentados usando FastAPI  | Verificar que todos los `@router` tengan `summary`, `description` y ejemplos                  |
| ğŸ”„ **GitHub Actions**            | Automatizar chequeo de calidad en cada `push`                               | Configurar workflow para: ejecutar `pytest` + correr `ruff` o `flake8` (lint)                 |

---

### ğŸ“ Paso 1: Pruebas de integraciÃ³n

**Objetivo:** Validar flujos reales del sistema (como lo usarÃ­a un cliente).

#### âœ… Ejemplo inicial que vamos a crear

```python
# tests/integration/test_flujo_completo.py

def test_flujo_creacion_y_movimiento(client, db_session):
    # Crear usuario admin
    crear_usuario_con_rol(db_session, "admin", "admin123", "admin")

    # Login y obtenciÃ³n de token
    login_response = client.post("/auth/login", data={"username": "admin", "password": "admin123"})
    token = login_response.json()["access_token"]
    headers = {"Authorization": f"Bearer {token}"}

    # Crear producto
    producto_data = {"nombre": "Laptop", "sku": "LT123", "stock_minimo": 2}
    r_prod = client.post("/productos/", json=producto_data, headers=headers)
    assert r_prod.status_code == 201

    # Hacer un movimiento de entrada
    movimiento_data = {"sku_producto": "LT123", "tipo": "entrada", "cantidad": 5}
    r_mov = client.post("/movimientos/", json=movimiento_data, headers=headers)
    assert r_mov.status_code == 201
```

ğŸ”§ Esto permite verificar que:

* El login funcione
* Se puedan usar credenciales para acceder a endpoints protegidos
* La creaciÃ³n de producto y su movimiento estÃ© enlazada correctamente

Â¿Te gustarÃ­a que avancemos creando este archivo juntos o querÃ©s que preparemos primero la parte de documentaciÃ³n con Swagger?

---

ğŸ“Œ *Sugerencia para trazar el avance en GitHub Project (Semana 6):*

* Tarea 1: Crear test de flujo completo de integraciÃ³n
* Tarea 2: Asegurar que todos los routers tengan summary + description
* Tarea 3: Crear archivo `.github/workflows/main.yml` para GitHub Actions

---

### âœ… 1. **Test de integraciÃ³n** (`tests/integration/test_flujo_completo.py`)

ğŸ“Œ **Lo que necesito saber:**

* Â¿QuerÃ©s testear el flujo completo de uso tipo:
  `login â†’ crear producto â†’ entrada de stock â†’ salida de stock â†’ verificar stock final`?
* Â¿Usamos los endpoints reales de tu API? (como `/auth/login`, `/productos/`, `/movimientos/entrada` y `/movimientos/salida`)
* Â¿La respuesta de `/me` o `/admin/zona-segura` tambiÃ©n debe ser parte del flujo?

ğŸ”§ Si confirmÃ¡s eso, **no necesito que me pases nada** mÃ¡s, puedo armarlo directamente con el `TestClient`.

---

### âœ… 2. **DocumentaciÃ³n con Swagger**

ğŸ“Œ **Lo que necesito revisar:**

* Confirmame si en tus endpoints de FastAPI (por ejemplo en `router.post(...)` de productos o movimientos) **ya tenÃ©s anotados los siguientes parÃ¡metros**:

  * `response_model=...`
  * `summary="..."` o `description="..."`

âš ï¸ Si **no tenÃ©s nada de eso**, confirmame quÃ© endpoints querÃ©s priorizar (por ejemplo: solo auth, usuarios y productos) y yo los documento desde cero.

---

### âœ… 3. **GitHub Actions**

ğŸ“Œ **Necesito saber:**

* Â¿UsÃ¡s `pytest`, `pytest-cov`, `ruff`, `flake8`, `black`, o alguna herramienta de anÃ¡lisis estÃ¡tico?

  * Por ahora asumo que tenÃ©s `pytest`, asÃ­ que puedo incluir eso.
* Â¿QuerÃ©s que el workflow se ejecute en cada push o solo en los pull requests?

  * Ej: `"on": ["push", "pull_request"]`

---

### ğŸ‘‡ En resumen:

Respondeme solo estas 3 cosas para avanzar 100%:

1. Â¿Flujo de test completo: login â†’ crear producto â†’ entrada â†’ salida â†’ verificar stock?
Quiero testear el flujo completo
2. Â¿QuerÃ©s que documente todos los endpoints o solo algunos?
Quiero documentar todo y ver los servicio
4. Â¿QuerÃ©s GitHub Actions con pytest y algÃºn linter? Â¿CuÃ¡l/es?

Con eso, Â¡armo todo de forma ordenada!



<!--stackedit_data:
eyJoaXN0b3J5IjpbMTM0MzM4OTExMywxNjM2NjUzNjk2LC04OD
Q0MjUzMTldfQ==
-->