## ğŸ“… Pruebas de integraciÃ³n

| Semana | Objetivos principales                                             |
| ------ | ----------------------------------------------------------------- |
| 6      | ğŸ§ª Pruebas de integraciÃ³n                                         |
|        | ğŸ“˜ DocumentaciÃ³n con Swagger                                      |
|        | ğŸ”„ Uso de GitHub Actions para lint + tests                        |

Asunto: Acceso al portal de alquiler
Â¡Excelente! Comencemos entonces con la **Semana 6**. AquÃ­ te propongo una **planificaciÃ³n clara y paso a paso**, con foco en trazabilidad y enseÃ±anza para tus estudiantes:

---

## âœ… Semana 6: PlanificaciÃ³n

| Objetivo                         | Detalle tÃ©cnico                                                             | Â¿QuÃ© vamos a hacer?                                                                           |
| -------------------------------- | --------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| ğŸ§ª **Pruebas de integraciÃ³n**    | Validar la interacciÃ³n real entre mÃºltiples capas (API + DB real o de test) | Crear tests que simulen flujos completos (ej: login â†’ crear producto â†’ movimiento de entrada) |
| ğŸ“˜ **DocumentaciÃ³n con Swagger** | Asegurar que los endpoints estÃ©n correctamente documentados usando FastAPI  | Verificar que todos los `@router` tengan `summary`, `description` y ejemplos                  |
| ğŸ”„ **GitHub Actions**            | Automatizar chequeo de calidad en cada `push`                               | Configurar workflow para: ejecutar `pytest` + correr `ruff` o `flake8` (lint)                 |

---

### ğŸ“ Paso 1: Pruebas de integraciÃ³n

**Objetivo:** Validar flujos reales del sistema (como lo usarÃ­a un cliente).

#### âœ… Ejemplo inicial que vamos a crear

```python
# tests/integration/test_flujo_completo.py

def test_flujo_creacion_y_movimiento(client, db_session):
    # Crear usuario admin
    crear_usuario_con_rol(db_session, "admin", "admin123", "admin")

    # Login y obtenciÃ³n de token
    login_response = client.post("/auth/login", data={"username": "admin", "password": "admin123"})
    token = login_response.json()["access_token"]
    headers = {"Authorization": f"Bearer {token}"}

    # Crear producto
    producto_data = {"nombre": "Laptop", "sku": "LT123", "stock_minimo": 2}
    r_prod = client.post("/productos/", json=producto_data, headers=headers)
    assert r_prod.status_code == 201

    # Hacer un movimiento de entrada
    movimiento_data = {"sku_producto": "LT123", "tipo": "entrada", "cantidad": 5}
    r_mov = client.post("/movimientos/", json=movimiento_data, headers=headers)
    assert r_mov.status_code == 201
```

ğŸ”§ Esto permite verificar que:

* El login funcione
* Se puedan usar credenciales para acceder a endpoints protegidos
* La creaciÃ³n de producto y su movimiento estÃ© enlazada correctamente

Â¿Te gustarÃ­a que avancemos creando este archivo juntos o querÃ©s que preparemos primero la parte de documentaciÃ³n con Swagger?

---

ğŸ“Œ *Sugerencia para trazar el avance en GitHub Project (Semana 6):*

* Tarea 1: Crear test de flujo completo de integraciÃ³n
* Tarea 2: Asegurar que todos los routers tengan summary + description
* Tarea 3: Crear archivo `.github/workflows/main.yml` para GitHub Actions

---

### âœ… 1. **Test de integraciÃ³n** (`tests/integration/test_flujo_completo.py`)

ğŸ“Œ **Lo que necesito saber:**

* Â¿QuerÃ©s testear el flujo completo de uso tipo:
  `login â†’ crear producto â†’ entrada de stock â†’ salida de stock â†’ verificar stock final`?
* Â¿Usamos los endpoints reales de tu API? (como `/auth/login`, `/productos/`, `/movimientos/entrada` y `/movimientos/salida`)
* Â¿La respuesta de `/me` o `/admin/zona-segura` tambiÃ©n debe ser parte del flujo?

ğŸ”§ Si confirmÃ¡s eso, **no necesito que me pases nada** mÃ¡s, puedo armarlo directamente con el `TestClient`.

---

### âœ… 2. **DocumentaciÃ³n con Swagger**

ğŸ“Œ **Lo que necesito revisar:**

* Confirmame si en tus endpoints de FastAPI (por ejemplo en `router.post(...)` de productos o movimientos) **ya tenÃ©s anotados los siguientes parÃ¡metros**:

  * `response_model=...`
  * `summary="..."` o `description="..."`

âš ï¸ Si **no tenÃ©s nada de eso**, confirmame quÃ© endpoints querÃ©s priorizar (por ejemplo: solo auth, usuarios y productos) y yo los documento desde cero.

---

### âœ… 3. **GitHub Actions**

ğŸ“Œ **Necesito saber:**

* Â¿UsÃ¡s `pytest`, `pytest-cov`, `ruff`, `flake8`, `black`, o alguna herramienta de anÃ¡lisis estÃ¡tico?

  * Por ahora asumo que tenÃ©s `pytest`, asÃ­ que puedo incluir eso.
* Â¿QuerÃ©s que el workflow se ejecute en cada push o solo en los pull requests?

  * Ej: `"on": ["push", "pull_request"]`

---


### ğŸ¯ Milestone: Semana 6

| Issue NÂº | TÃ­tulo                                                                                   | Etiquetas               |
| -------- | ---------------------------------------------------------------------------------------- | ----------------------- |
| #1       | ğŸ§ª Crear test de integraciÃ³n: flujo login â†’ alta de producto â†’ entrada â†’ salida â†’ stock  | `test`, `integraciÃ³n`   |
| #2       | ğŸ“˜ Documentar todos los endpoints con Swagger (FastAPI)                                  | `documentaciÃ³n`, `API`  |
| #3       | ğŸš€ Configurar GitHub Actions para ejecutar pytest en cada push/pull request              | `CI`, `GitHub Actions`  |
| #4       | ğŸ” Agregar linter (como `flake8`) y configurar su ejecuciÃ³n automÃ¡tica en GitHub Actions | `CI`, `lint`, `calidad` |

---

Â¡Excelente trabajo! ğŸ‰ Que hayas completado exitosamente el **test de integraciÃ³n del flujo completo** es un **gran hito** y marca un avance sÃ³lido en la **Semana 6** del proyecto de Inventario 2025.

---

### ğŸ“ Estado actual al cierre del test de integraciÃ³n:

âœ… **Test de integraciÃ³n de flujo completo funcionando**:

* Login âœ”ï¸
* Crear producto con `stock_minimo` âœ”ï¸
* Crear depÃ³sito âœ”ï¸
* Registrar movimiento (entrada) âœ”ï¸
* VerificaciÃ³n de stock âœ”ï¸ (implÃ­cita o prÃ³xima si la incluÃ­s)

âœ… **Campo `stock_minimo` agregado sin romper pruebas anteriores**
âœ… **MigraciÃ³n con Alembic adaptada correctamente**
âœ… **Esquemas Pydantic actualizados**
âœ… **Pruebas unitarias no rotas por el nuevo campo**
âœ… **Sistema funcionando en consola + API**

---

### ğŸ“… Plan de Semana 6 (segÃºn lo que me habÃ­as dicho):

1. âœ… **Test de integraciÃ³n completo (flujo de extremo a extremo)**
2. âœ… **DocumentaciÃ³n con Swagger (`/docs`)**
3. â³ **ConfiguraciÃ³n de GitHub Actions con:**

   * `pytest` ejecutando los tests automÃ¡ticamente ğŸ§ª
   * `linter` (como `ruff` o `flake8`) para mantener calidad de cÃ³digo ğŸ‘¨â€ğŸ”§

---

### ğŸ§­ QuÃ© sigue ahora

#### ğŸ”¹ 1. RevisiÃ³n y documentaciÃ³n:

* VerificÃ¡ que **todos los endpoints relevantes** estÃ©n bien documentados en `/docs`.
* CompletÃ¡ descripciones en los modelos y respuestas si querÃ©s que sea mÃ¡s claro.

#### ğŸ”¹ 2. GitHub Actions (CI/CD mÃ­nimo):

* Crear un archivo `.github/workflows/ci.yml`
* Que corra `pytest` y `ruff` o `flake8` en cada push o pull request.

#### ğŸ”¹ 3. Opcionales (si tenÃ©s tiempo y ganas):

* Mostrar alertas o advertencias cuando el `stock` de un producto estÃ© por debajo del `stock_minimo` (lÃ³gica de negocio).
* Implementar endpoint tipo: `GET /productos/bajo-stock`.

---

### âœ… En resumen:

| Tarea                                    | Estado      |
| ---------------------------------------- | ----------- |
| MigraciÃ³n `stock_minimo`                 | âœ…           |
| AdaptaciÃ³n de modelos y tests            | âœ…           |
| Test de integraciÃ³n completo             | âœ…           |
| DocumentaciÃ³n de Swagger funcional       | âš ï¸ revisar  |
| CI con GitHub Actions (`pytest`, `lint`) | âŒ pendiente |
| Alertas de bajo stock (opcional)         | âŒ pendiente |

---

ğŸ“ **Â¿QuerÃ©s que repasemos o armemos juntos el `ci.yml` para GitHub Actions con pytest + linter ahora?**
O si preferÃ­s, pasame el plan original de Semana 6 y ajustamos el checklist con base en eso.

Perfecto, vamos a implementar la integraciÃ³n continua (CI) con GitHub Actions en 2 pasos:

----------

## ğŸ§ª Paso 1 â€“ Crear el workflow `ci.yml`

CreÃ¡ el archivo en:

```
.github/workflows/ci.yml

```

Con este contenido:

```yaml
name: CI - Test y Lint

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Clonar repositorio
      uses: actions/checkout@v3

    - name: ğŸ Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    - name: ğŸ“¦ Instalar dependencias
      run: |
        python -m venv venv
        source venv/bin/activate
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pytest ruff

    - name: ğŸ§ª Ejecutar tests
      run: |
        source venv/bin/activate
        pytest -v

    - name: ğŸ§¹ Ejecutar linter Ruff
      run: |
        source venv/bin/activate
        ruff app tests

```

----------

## ğŸ§¹ Paso 2 â€“ Instalar Ruff localmente (opcional pero Ãºtil)

### âœ… SoluciÃ³n

UsÃ¡ este comando:

```bash
ruff check app tests

```

Si querÃ©s que ademÃ¡s **corrija automÃ¡ticamente** errores simples de formato (como `black`), podÃ©s hacer:

```bash
ruff check app tests --fix

```

----------

### ğŸ› ï¸ QuÃ© cambiar en `ci.yml`

En el workflow de GitHub Actions, cambiÃ¡ esta parte:

```yaml
- name: ğŸ§¹ Ejecutar linter Ruff
  run: |
    source venv/bin/activate
    ruff app tests

```

Por esto:

```yaml
- name: ğŸ§¹ Ejecutar linter Ruff
  run: |
    source venv/bin/activate
    ruff check app tests

```

----------

Â¿QuerÃ©s que armemos ahora el `ci.yml` ya adaptado con `ruff check` y `pytest` usando tu estructura de proyecto, o preferÃ­s probarlo localmente primero?

```

> Ruff es un linter ultra rÃ¡pido y compatible con flake8/black.

----------

## âœ… Resultado esperado

-   Cada vez que hagas `push` o `pull_request` a `main`:
    
    -   Se instala el entorno virtual
        
    -   Se ejecuta `pytest`
        
    -   Se aplica `ruff` sobre `app` y `tests`
        
-   Si todo pasa, ves un âœ… en la pestaÃ±a **Actions** del repo
    

----------


## âœ… Â¿QuÃ© hiciste esta semana (Semana 6)?

Ya cumpliste con los principales objetivos de la planificaciÃ³n:

1. **âœ”ï¸ Pruebas de integraciÃ³n (flujo completo):** aprobadas.
2. **âœ”ï¸ DocumentaciÃ³n de endpoints con Swagger:** accesible en `/docs`.
3. **âœ”ï¸ GitHub Actions corriendo tests y linting:** funcional y validado.

---

## ğŸ§­ Â¿QuÃ© podrÃ­as hacer ahora para cerrar bien la Semana 6?

### 1. **ğŸ’¡ Crear un tag o release estable**

**SÃ­, es una buena prÃ¡ctica.** Esto te deja un **punto de restauraciÃ³n** claro si algo falla mÃ¡s adelante, y marca el cierre del primer ciclo de desarrollo completo.

* ğŸ·ï¸ Tag sugerido: `v1.0.0-alpha` o `v0.6.0`
* Nombre: `VersiÃ³n estable al cierre de Semana 6`
* DescripciÃ³n:

  > * Sistema bÃ¡sico de inventario funcional
  > * Login + autenticaciÃ³n + autorizaciÃ³n
  > * CRUD de producto, movimiento, depÃ³sito
  > * Test unitarios e integraciÃ³n
  > * GitHub Actions y documentaciÃ³n Swagger

PodÃ©s crear el tag desde consola:

```bash
git tag -a v0.6.0 -m "VersiÃ³n estable cierre de Semana 6"
git push origin v0.6.0
```

O usar la interfaz de GitHub en Releases.

---

### 2. **ğŸ—‚ï¸ Cerrar el milestone y limpiar issues**

* CerrÃ¡ el *milestone Semana 6*.
* MovÃ© issues no resueltos a *Semana 7* o a un backlog.
* PodÃ©s anotar en un `CHANGELOG.md` el resumen de esta semana.

---

### 3. **ğŸ“˜ Documentar el estado del proyecto**

Te sugiero dejar un resumen de estado en el README o como `docs/Estado_Semana6.md`:

```markdown
## âœ… Estado al cierre de Semana 6

- Base de datos y backend funcionando con FastAPI
- AutenticaciÃ³n JWT con roles ("admin", "operador")
- CRUD completo de productos, depÃ³sitos y movimientos
- Pruebas unitarias y de integraciÃ³n con pytest
- CI configurado con GitHub Actions
- DocumentaciÃ³n auto-generada con Swagger en /docs
```





<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE4Njk1NDE5MCwxOTAxMjU0OTIwLDE2Mj
g5MjAwODMsLTE3NjUyMzE2NTQsMzI2OTE0Njg3LDE2MzY2NTM2
OTYsLTg4NDQyNTMxOV19
-->