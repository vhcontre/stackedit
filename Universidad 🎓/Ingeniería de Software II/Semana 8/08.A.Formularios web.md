## ğŸ“… **Semana 8 â€“ PlanificaciÃ³n tÃ©cnica**

| Objetivo                               | ImplementaciÃ³n paso a paso                                                    |
| -------------------------------------- | ----------------------------------------------------------------------------- |
| ğŸ’¾ **Formulario web para movimientos** | Crear una vista para cargar un nuevo movimiento (alta de stock, retiro, etc.) |
| ğŸ§ª **ValidaciÃ³n con FastAPI + Jinja2** | Validar campos en el backend, mostrar errores si existen                      |

---

### âœ… Paso 1 â€“ Crear la ruta y vista del formulario

Vamos a empezar por mostrar un formulario HTML para cargar movimientos.

#### ğŸ“ `app/templates/movimiento_form.html`

```html
{% extends "base.html" %}
{% block content %}
<h2>ğŸ“¦ Registrar Movimiento</h2>

<form action="/web/movimientos" method="post">
    <label for="producto_id">Producto ID:</label>
    <input type="number" name="producto_id" required><br>

    <label for="usuario_id">Usuario ID:</label>
    <input type="number" name="usuario_id" required><br>

    <label for="tipo">Tipo de movimiento:</label>
    <select name="tipo" required>
        <option value="ingreso">Ingreso</option>
        <option value="egreso">Egreso</option>
    </select><br>

    <label for="cantidad">Cantidad:</label>
    <input type="number" name="cantidad" required><br>

    <label for="deposito_origen_id">DepÃ³sito origen (opcional):</label>
    <input type="number" name="deposito_origen_id"><br>

    <label for="deposito_destino_id">DepÃ³sito destino (opcional):</label>
    <input type="number" name="deposito_destino_id"><br>

    <button type="submit">Registrar</button>
</form>

{% if error %}
<p style="color: red;">{{ error }}</p>
{% endif %}
{% endblock %}
```

---

### âœ… Paso 2 â€“ Ruta GET y POST para mostrar y procesar el formulario

#### ğŸ“ `app/routers/web_interface.py` (agregÃ¡ al final)

```python
from fastapi import Form
from fastapi.responses import RedirectResponse
from app.repositories.movimiento_repository import MovimientoRepository
from app.repositories.movimiento_repository import MovimientoRepository
from app.db.session import get_db
from datetime import datetime
from datetime import datetime
from app.domain.models.movimiento import Movimiento, TipoMovimiento as DomainTipoMovimiento

@router.get("/web/movimientos")
def mostrar_formulario_movimiento(request: Request):
    return templates.TemplateResponse("movimiento_form.html", {"request": request})

@router.post("/web/movimientos")
def procesar_formulario_movimiento(
    request: Request,
    producto_id: int = Form(...),
    usuario_id: int = Form(...),
    tipo: str = Form(...),
    cantidad: int = Form(...),
    deposito_origen_id: int = Form(None),
    deposito_destino_id: int = Form(None),
    db: Session = Depends(get_db)
):
    try:
        repo = MovimientoRepository(db)

        movimiento = Movimiento(
            id=None,
            producto_id=producto_id,
            usuario_id=usuario_id,
            cantidad=cantidad,
            tipo=DomainTipoMovimiento(tipo),  # convierte el string a enum
            deposito_origen_id=deposito_origen_id,
            deposito_destino_id=deposito_destino_id,
            fecha=datetime.now().date(),
            timestamp=datetime.now()
        )

        repo.create_movimiento(movimiento)
        return RedirectResponse("/web/productos", status_code=303)

    except Exception as e:
        return templates.TemplateResponse(
            "movimiento_form.html",
            {"request": request, "error": str(e)}
        )

```

---

### âœ… Paso 3 â€“ Verificar dependencias

Tu `requirements.txt` debe incluir:

```
python-multipart
```

Ya lo resolviste en la semana pasada. ğŸ˜‰

---

### âœ… Paso 4 â€“ Probar en el navegador

1. LevantÃ¡ FastAPI como siempre:

   ```bash
   uvicorn app.main:app
   ```

2. AccedÃ© a `http://localhost:8000/web/movimientos`

3. CompletÃ¡ el formulario y verificÃ¡ si se guarda correctamente.


## VerificaciÃ³n general Semana 8 â€“ Reporte consolidado

| Objetivo                              | Estado       | Comentarios                                                                                  |
| ------------------------------------- | ------------ | -------------------------------------------------------------------------------------------- |
| ğŸ’¾ Formularios web para movimientos   | âœ… Completado | Formulario para registrar movimientos funcional, con POST y GET                              |
| ğŸ§ª ValidaciÃ³n y manejo de formularios | âœ… Completado | Validaciones de stock, existencia de producto y datos obligatorios implementadas y probadas  |
| ğŸ› ï¸ Manejo de errores y UX            | âœ… Completado | Muestra errores en pantalla sin perder datos ingresados, mejora experiencia de usuario       |
| ğŸ”„ RedirecciÃ³n y confirmaciÃ³n         | âœ… Completado | Tras alta exitosa, redirige a listado de productos correctamente                             |
| ğŸ§© IntegraciÃ³n con repositorio        | âœ… Completado | La lÃ³gica de creaciÃ³n y actualizaciÃ³n de stock estÃ¡ integrada en `MovimientoRepository`      |
| ğŸ–¥ï¸ PresentaciÃ³n visual               | âœ… Completado | El formulario usa plantillas Jinja2 para una interfaz bÃ¡sica funcional                       |
| ğŸ§ª Pruebas bÃ¡sicas                    | âœ… Completado | Se probaron casos con stock insuficiente, productos inexistentes, egresos/ingresos/traslados |

---

### Estado actual:

* CÃ³digo limpio y funcional para registrar movimientos desde la web
* Validaciones robustas para mantener integridad de stock
* UX bÃ¡sica pero efectiva para manejo de errores y feedback
* Base lista para avanzar a mejoras en la interfaz o nuevas funcionalidades



<!--stackedit_data:
eyJoaXN0b3J5IjpbLTQ5OTM4MDI4NiwtMTEwMjU1MDIzOCwtMz
E3OTMxNjczXX0=
-->