## 📅 **Semana 8 – Planificación técnica**

| Objetivo                               | Implementación paso a paso                                                    |
| -------------------------------------- | ----------------------------------------------------------------------------- |
| 💾 **Formulario web para movimientos** | Crear una vista para cargar un nuevo movimiento (alta de stock, retiro, etc.) |
| 🧪 **Validación con FastAPI + Jinja2** | Validar campos en el backend, mostrar errores si existen                      |

---

### ✅ Paso 1 – Crear la ruta y vista del formulario

Vamos a empezar por mostrar un formulario HTML para cargar movimientos.

#### 📁 `app/templates/movimiento_form.html`

```html
{% extends "base.html" %}
{% block content %}
  <h2>📦 Registrar Movimiento</h2>
  <form action="/web/movimientos" method="post">
    <label>Producto ID:</label>
    <input type="number" name="producto_id" required><br>

    <label>Tipo:</label>
    <select name="tipo" required>
      <option value="entrada">Entrada</option>
      <option value="salida">Salida</option>
    </select><br>

    <label>Cantidad:</label>
    <input type="number" name="cantidad" required><br>

    <button type="submit">Registrar</button>
  </form>

  {% if error %}
    <p style="color: red;">{{ error }}</p>
  {% endif %}
{% endblock %}
```

---

### ✅ Paso 2 – Ruta GET y POST para mostrar y procesar el formulario

#### 📁 `app/routers/web_interface.py` (agregá al final)

```python
from fastapi import Form
from fastapi.responses import RedirectResponse
from app.repositories.movimiento_repository import MovimientoRepository
from app.db.session import get_db
from app.domain.models.movimiento import Movimiento

@router.get("/web/movimientos")
def mostrar_formulario_movimiento(request: Request):
    return templates.TemplateResponse("movimiento_form.html", {"request": request})

@router.post("/web/movimientos")
def procesar_formulario_movimiento(
    request: Request,
    producto_id: int = Form(...),
    tipo: str = Form(...),
    cantidad: int = Form(...),
    db: Session = Depends(get_db)
):
    try:
        repo = MovimientoRepository(db)
        movimiento = Movimiento(
            id=None,
            producto_id=producto_id,
            tipo=tipo,
            cantidad=cantidad
        )
        repo.crear_movimiento(movimiento)
        return RedirectResponse("/web/productos", status_code=303)
    except Exception as e:
        return templates.TemplateResponse(
            "movimiento_form.html",
            {"request": request, "error": str(e)}
        )
```

---

### ✅ Paso 3 – Verificar dependencias

Tu `requirements.txt` debe incluir:

```
python-multipart
```

Ya lo resolviste en la semana pasada. 😉

---

### ✅ Paso 4 – Probar en el navegador

1. Levantá FastAPI como siempre:

   ```bash
   uvicorn app.main:app
   ```

2. Accedé a `http://localhost:8000/web/movimientos`

3. Completá el formulario y verificá si se guarda correctamente.

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTMxNzkzMTY3M119
-->