## ğŸ“… **Semana 8 â€“ PlanificaciÃ³n tÃ©cnica**

| Objetivo                               | ImplementaciÃ³n paso a paso                                                    |
| -------------------------------------- | ----------------------------------------------------------------------------- |
| ğŸ’¾ **Formulario web para movimientos** | Crear una vista para cargar un nuevo movimiento (alta de stock, retiro, etc.) |
| ğŸ§ª **ValidaciÃ³n con FastAPI + Jinja2** | Validar campos en el backend, mostrar errores si existen                      |

---

### âœ… Paso 1 â€“ Crear la ruta y vista del formulario

Vamos a empezar por mostrar un formulario HTML para cargar movimientos.

#### ğŸ“ `app/templates/movimiento_form.html`

```html
{% extends "base.html" %}
{% block content %}
<h2>ğŸ“¦ Registrar Movimiento</h2>

<form action="/web/movimientos" method="post">
    <label for="producto_id">Producto ID:</label>
    <input type="number" name="producto_id" required><br>

    <label for="usuario_id">Usuario ID:</label>
    <input type="number" name="usuario_id" required><br>

    <label for="tipo">Tipo de movimiento:</label>
    <select name="tipo" required>
        <option value="ingreso">Ingreso</option>
        <option value="egreso">Egreso</option>
    </select><br>

    <label for="cantidad">Cantidad:</label>
    <input type="number" name="cantidad" required><br>

    <label for="deposito_origen_id">DepÃ³sito origen (opcional):</label>
    <input type="number" name="deposito_origen_id"><br>

    <label for="deposito_destino_id">DepÃ³sito destino (opcional):</label>
    <input type="number" name="deposito_destino_id"><br>

    <button type="submit">Registrar</button>
</form>

{% if error %}
<p style="color: red;">{{ error }}</p>
{% endif %}
{% endblock %}
```

---

### âœ… Paso 2 â€“ Ruta GET y POST para mostrar y procesar el formulario

#### ğŸ“ `app/routers/web_interface.py` (agregÃ¡ al final)

```python
from fastapi import Form
from fastapi.responses import RedirectResponse
from app.repositories.movimiento_repository import MovimientoRepository
from app.db.session import get_db
from app.domain.models.movimiento import Movimiento

@router.get("/web/movimientos")
def mostrar_formulario_movimiento(request: Request):
    return templates.TemplateResponse("movimiento_form.html", {"request": request})

@router.post("/web/movimientos")
def procesar_formulario_movimiento(
    request: Request,
    producto_id: int = Form(...),
    tipo: str = Form(...),
    cantidad: int = Form(...),
    db: Session = Depends(get_db)
):
    try:
        repo = MovimientoRepository(db)
        movimiento = Movimiento(
            id=None,
            producto_id=producto_id,
            tipo=tipo,
            cantidad=cantidad
        )
        repo.crear_movimiento(movimiento)
        return RedirectResponse("/web/productos", status_code=303)
    except Exception as e:
        return templates.TemplateResponse(
            "movimiento_form.html",
            {"request": request, "error": str(e)}
        )
```

---

### âœ… Paso 3 â€“ Verificar dependencias

Tu `requirements.txt` debe incluir:

```
python-multipart
```

Ya lo resolviste en la semana pasada. ğŸ˜‰

---

### âœ… Paso 4 â€“ Probar en el navegador

1. LevantÃ¡ FastAPI como siempre:

   ```bash
   uvicorn app.main:app
   ```

2. AccedÃ© a `http://localhost:8000/web/movimientos`

3. CompletÃ¡ el formulario y verificÃ¡ si se guarda correctamente.

<!--stackedit_data:
eyJoaXN0b3J5IjpbLTkxMjI0NzgzMCwtMzE3OTMxNjczXX0=
-->